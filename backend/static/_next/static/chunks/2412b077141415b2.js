(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97418,e=>{"use strict";e.s(["default",()=>m],97418);var a=e.i(43476),s=e.i(71645),t=e.i(70065),n=e.i(67881),c=e.i(84762),l=e.i(71435),r=e.i(62198),i=e.i(54858);let d=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var o=e.i(14764);function m(){let[e,m]=(0,s.useState)([]),[h,u]=(0,s.useState)(null),[x,f]=(0,s.useState)([]),[g,p]=(0,s.useState)(""),[_,j]=(0,s.useState)(!1),[N,b]=(0,s.useState)(!1),v=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=(0,r.getSocket)();return e.connect(),w(),e.on("chat_created",e=>{u(e.chat_id),w()}),e.on("student_connected",e=>{f(e.history||[]),j(e.is_admin_connected),e.chat&&b(e.chat.is_human_enabled)}),e.on("new_message",e=>{e.chat_id===h&&f(a=>[...a,e])}),e.on("escalation_triggered",e=>{e.chat_id===h&&b(e.is_human_enabled)}),e.on("admin_status_changed",e=>{e.chat_id===h&&j(e.is_admin_connected)}),e.on("human_enabled_changed",e=>{e.chat_id===h&&b(e.is_human_enabled)}),()=>{e.off("chat_created"),e.off("student_connected"),e.off("new_message"),e.off("escalation_triggered"),e.off("admin_status_changed"),e.off("human_enabled_changed")}},[h]),(0,s.useEffect)(()=>{var e;null==(e=v.current)||e.scrollIntoView({behavior:"smooth"})},[x]);let w=async()=>{let e=await i.api.getAllChats();e.success&&m(e.chats)},y=()=>{(0,r.getSocket)().emit("student_connect",{})},C=()=>{g.trim()&&h&&((0,r.getSocket)().emit("student_message",{chat_id:h,message:g}),p(""))};return(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col p-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Student Chat"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chat with our AI assistant to learn about Havana University"})]}),h?(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsx)(t.Card,{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-950",children:(0,a.jsx)("p",{className:"text-sm font-medium",children:_?"✓ Admin connected":"⏳ Finding next available admin..."})}),(0,a.jsx)(l.ScrollArea,{className:"flex-1 mb-4 h-[calc(100vh-300px)]",children:(0,a.jsxs)("div",{className:"space-y-4 pr-4",children:[x.map((e,s)=>{var n,c;return(0,a.jsx)(t.Card,{className:"max-w-[80%] ".concat("human"===(n=e.role)?"bg-blue-100 dark:bg-blue-900 ml-auto":"ai"===n?"bg-gray-100 dark:bg-gray-800 mr-auto":"human_operator"===n?"bg-green-100 dark:bg-green-900 mr-auto":""),children:(0,a.jsxs)(t.CardContent,{className:"p-3",children:[(0,a.jsx)("p",{className:"text-xs font-semibold mb-1",children:"human"===(c=e.role)?"You":"ai"===c?"AI Assistant":"human_operator"===c?"Admin":c}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.message})]})},s)}),(0,a.jsx)("div",{ref:v})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.Textarea,{value:g,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},placeholder:"Type your message...",className:"flex-1 min-h-[60px] max-h-[120px]"}),(0,a.jsx)(n.Button,{onClick:C,size:"icon",className:"h-[60px] w-[60px]",children:(0,a.jsx)(o.Send,{className:"h-5 w-5"})})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)(t.Card,{className:"p-8 text-center",children:[(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"No chat selected"}),(0,a.jsxs)(n.Button,{onClick:y,children:[(0,a.jsx)(d,{className:"mr-2 h-4 w-4"}),"Start New Chat"]})]})})]}),(0,a.jsxs)("div",{className:"w-80 border-l p-4",children:[(0,a.jsxs)(n.Button,{onClick:y,className:"w-full mb-4",children:[(0,a.jsx)(d,{className:"mr-2 h-4 w-4"}),"New Chat"]}),(0,a.jsx)(l.ScrollArea,{className:"h-[calc(100vh-120px)]",children:(0,a.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,a.jsx)(t.Card,{className:"cursor-pointer hover:bg-accent transition-colors ".concat(h===e.id?"border-primary":""),onClick:()=>{var a;u(a=e.id),(0,r.getSocket)().emit("student_connect",{chat_id:a})},children:(0,a.jsxs)(t.CardContent,{className:"p-3",children:[(0,a.jsxs)("p",{className:"font-medium",children:["Chat #",e.id]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleString()}),e.is_human_enabled&&(0,a.jsx)("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 mt-1",children:"Human assistance active"})]})},e.id))})})]})]})}}]);